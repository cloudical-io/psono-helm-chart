# change the host
host: psono.example.com

ingress:
  enabled: true
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/rewrite-target: /$1
    nginx.ingress.kubernetes.io/use-regex: "true"
  hosts:
    # change the host
    - host: psono.example.com

server:
  extra_settings_files:
    - /vault/secrets/credentials

  podAnnotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: psono-database
    vault.hashicorp.com/agent-inject-secret-psql-password: kv/data/psono/database
    vault.hashicorp.com/agent-inject-template-psql-password: |
      {{- with secret "kv/data/psono/database" -}}
      {{ .Data.data.password }}
      {{- end -}}
    vault.hashicorp.com/agent-inject-secret-credentials: kv/data/psono/credentials
    vault.hashicorp.com/agent-inject-template-credentials: |
      {{- with secret "kv/data/psono/credentials" -}}
      {{ .Data.data.text }}
      {{- end -}}

  databases:
    default:
      name: psono
      user: psono
      password_file: /vault/secrets/psql-password

  #Â THIS IS REQUIRED BUT HIGHLY SPECIFIC, PLEASE CHECK:
  # https://doc.psono.com/admin/installation/install-server-ce.html#installation-with-docker
  settings: {}

database:
  env:
    POSTGRES_PASSWORD_FILE: /vault/secrets/psql-password
    POSTGRES_USER: psono
    POSTGRES_DB: psono

  podAnnotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: psono-database
    vault.hashicorp.com/agent-inject-secret-psql-password: kv/data/psono/database
    vault.hashicorp.com/agent-inject-template-psql-password: |
      {{- with secret "kv/data/psono/database" -}}
      {{ .Data.data.password }}
      {{- end -}}